<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monkeyquiz - Test page</title>
    <link rel="stylesheet" href="/public/test_page/test_page_style.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100..900;1,100..900&display=swap');
    </style>
</head>
<body>
    <div>
        <nav class="nav">
            <ul>
                <li><a href="#home"><b>Monkey Quiz</b></a></li>
                <li><a href="#about">About us</a></li>
                <li><a href="#contact">Contact us</a></li>
                <li><a href="">log out</a></li>
                <li><a href="">acc name</a></li>
            </ul>
        </nav>
    </div>

    <div class="info_and_lb">
        <table class="tb" style="width: 100%; height: 100%;">
            <tr>
                <td class="info">
                    <div class="srh">
                        <form id="searchForm">
                            <div class="search-box">
                                <input type="text" placeholder="Search Topic" name="search" id="search-input" list="suggestions">
                                <datalist id="suggestions">
                                    <option value="Math"></option>
                                    <option value="Science"></option>
                                    <option value="Computers"></option>
                                    <option value="Any"></option>
                                </datalist>
                                <button type="submit">Search</button>
                            </div>
                        </form>
                        <div class="dis">
                            <div class="dif"><p>Select your Difficulty Level:</p></div>
                            <div class="checkbox-group">
                                <label class="checkbox-label">
                                    <input type="radio" name="difficulty" value="any">
                                    <span class="custom-box">Any</span>
                                </label>
                                <label class="checkbox-label">
                                    <input type="radio" name="difficulty" value="easy">
                                    <span class="custom-box">Easy</span>
                                </label>
                                <label class="checkbox-label">
                                    <input type="radio" name="difficulty" value="medium">
                                    <span class="custom-box">Medium</span>
                                </label>
                                <label class="checkbox-label">
                                    <input type="radio" name="difficulty" value="hard">
                                    <span class="custom-box">Hard</span>
                                </label>
                            </div>
                        </div>
                        <button class="start-test-btn" id="startTestButton">Start Test</button>
                    </div>
                </td>
                <td class="lb">
                    <div class="leaderboard-container">
                        <h3 id="leaderboardTitle" style="text-align: center; padding: 10px; font-family: Arial, Helvetica, sans-serif; font-size: 25px;">Leaderboard - Any</h3>
                        <table class="leaderboard-table" id="leaderboardTable">
                            <thead>
                                <tr>
                                    <th class="lb_item">Rank</th>
                                    <th class="lb_item">Username</th>
                                    <th class="lb_item">Score</th>
                                    <th class="lb_item">Attempted</th>
                                </tr>
                            </thead>
                            <tbody id="leaderboardBody">
                                <tr>
                                    <td class="lb_item">1</td>
                                    <td class="lb_item">UserA</td>
                                    <td class="lb_item">100</td>
                                    <td class="lb_item">5</td>
                                </tr>
                                <tr>
                                    <td class="lb_item">2</td>
                                    <td class="lb_item">UserB</td>
                                    <td class="lb_item">95</td>
                                    <td class="lb_item">4</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </td>
            </tr>
            <tr>
                <td colspan="2">
                    <div class="classroom-container">
                        <div class="classroom-input">
                            <input type="text" placeholder="Enter Classroom Code" class="classroom-code-input">
                            <button>Join</button>
                        </div>
                        <div class="existing-classrooms">
                            <div class="classroom-box">Classroom A</div>
                            <div class="classroom-box">Classroom B</div>
                            <div class="classroom-box">Classroom C</div>
                            <div class="classroom-box">Classroom D</div>
                            <div class="classroom-box">Classroom E</div>
                            <div class="classroom-box">Classroom F</div>
                            <div class="classroom-box">Classroom G</div>
                        </div>
                    </div>
                </td>
            </tr>
        </table>
    </div>
    <script>
        document.getElementById('searchForm').addEventListener('submit', function(event) {
            event.preventDefault();
            const searchTerm = document.getElementById('search-input').value;
            const normalizedSearch = findClosestTopic(searchTerm);
            document.getElementById('search-input').value = normalizedSearch;
            fetchLeaderboard(normalizedSearch);
        });

        function findClosestTopic(term) {
            const possibleTopics = ['math', 'science', 'computers'];
            const lowerTerm = term.toLowerCase();

            for (const topic of possibleTopics) {
                if (topic.startsWith(lowerTerm)) {
                    return topic;
                }
            }
            return 'any';
        }

        function fetchLeaderboard(topic) {
            const leaderboardData = getLeaderboardData(topic);

            document.getElementById('leaderboardTitle').textContent = `Leaderboard - ${topic.charAt(0).toUpperCase() + topic.slice(1)}`;

            const leaderboardBody = document.getElementById('leaderboardBody');
            leaderboardBody.innerHTML = '';

            leaderboardData.forEach(item => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="lb_item">${item.rank}</td>
                    <td class="lb_item">${item.username}</td>
                    <td class="lb_item">${item.score}</td>
                    <td class="lb_item">${item.attempts}</td>
                `;
                leaderboardBody.appendChild(row);
            });
        }

        function getLeaderboardData(topic) {
            switch (topic) {
                case 'math':
                    return [
                        { rank: 1, username: 'MathMaster', score: 120, attempts: 6 },
                        { rank: 2, username: 'NumberNinja', score: 110, attempts: 5 },
                        { rank: 3, username: 'CalcKing', score: 105, attempts: 7 }
                    ];
                case 'science':
                    return [
                        { rank: 1, username: 'SciWhiz', score: 115, attempts: 5 },
                        { rank: 2, username: 'LabLegend', score: 100, attempts: 4 },
                        { rank: 3, username: 'ChemChamp', score: 98, attempts: 6 }
                    ];
                case 'computers':
                    return [
                        { rank: 1, username: 'CodeCrusher', score: 130, attempts: 7 },
                        { rank: 2, username: 'ByteBoss', score: 125, attempts: 6 },
                        { rank: 3, username: 'DebugDude', score: 118, attempts: 5 }
                    ];
                case 'any':
                default:
                    return [
                        { rank: 1, username: 'GlobalWinner', score: 140, attempts: 8 },
                        { rank: 2, username: 'AllRounder', score: 135, attempts: 7 },
                        { rank: 3, username: 'GeneralGenius', score: 132, attempts: 6 }
                    ];
            }
        }

        document.getElementById('startTestButton').addEventListener('click', function() {
            const topic = document.getElementById('search-input').value.toLowerCase();
            const difficulty = document.querySelector('input[name="difficulty"]:checked');

            if (!difficulty) {
                alert("Please select a difficulty level.");
                return;
            }

            let category = '';
            switch (topic) {
                case 'math':
                    category = '19';
                    break;
                case 'computers':
                    category = '18';
                    break;
                case 'science':
                    category = '17';
                    break;
                default:
                    category = '';
            }

            let apiUrl = 'https://opentdb.com/api.php?amount=10&type=multiple';
            if (category) {
                apiUrl += `&category=${category}`;
            }
            if(difficulty.value !== 'any') {
              apiUrl += `&difficulty=${difficulty.value}`;
            }

            fetch(apiUrl)
                .then(response => response.json())
                .then(data => {
                    localStorage.setItem('quizData', JSON.stringify(data.results));
                    window.location.href = '../quiz_test/quiz_test.html';
                })
                .catch(error => {
                    console.error('Error fetching quiz:', error);
                    alert('Error starting quiz. Please try again.');
                });
        });
    </script>
</body>
</html>
